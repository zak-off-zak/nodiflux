# nodiflux
A light weight decentalized, long-range, low-power, mesh communication protocol for IoT devices

## Introduction
Nodiflux is a protocol to enable decentralized. long-range, low-power communication between entitries over a set of IoT node. This reposiory presents a complete implementation of the protocol using NodeMCU ESP32 modlus as node. The goal of the protocol is to allow for short message delivery between nodes on the network without a central entitry for routing management.

## Protocol Design
This section presents the high-level design principles behind the protocol. The protocol occupies the third layer (network layer) of the OSI model. The nodiflux is, therefore, responsible for structuring and managing a multi-node network. Specifically, the nodiflux protocol manages addressing, routing, and network traffic control. The current implementation of the protocol uses [ESP-NOW v0.1](https://docs.espressif.com/projects/esp-idf/en/stable/esp32/api-reference/network/esp_now.html) for data link and physical layers of the network.

### Packets
The nodiflux protocol supports three types of packets. Specifically, *discovery (DIS)*, *data (DAT)*, and *acknowledgement(ACK)* packets are to be exchanged between nodes. All three types of the packets share common headers presented below:
| Field       | Size(bytes)    | Description |
|------------|----------|-------------|
| PacketType | 1 | A field to specify the type of a packet: DIS (0x01), ACK (0x02), and DAT (0x03). |
| src        | 6 | This field contains the MAC address of the sender. |
| pkt_id     | 16 | A field that contains a unique identification number of a packet. The ID is automatically generated by combining the MAC address of the sender and a random number. |
| chs        | 1 | This field contains a checksum of all fields of a given packet. The checksum is calculated as the XOR of all bytes of a packet and is used to verify data integrity. |

Discovery packets do not posses any additional fields, as they are kept small for ensuring as little resource usage during the node discovery process, as possible. On the other hand, data and acknowledge packets entail additional fields, that are presented in the following table:
| Packet Type          | Field        | Size (bytes)                         | Description |
|----------------------|--------------|------------------------------|-------------|
| DataPacket           | dest         | 6 | This field contains the MAC address of the receiver. |
| DataPacket           | ttl          | 1 | A field that holds the TTL value of the packet — the maximum number of hops before the packet is dropped. |
| DataPacket           | msg          | DATA_MESSAGE_SIZE | This field contains the actual binary message to be transmitted over the network. The DATA_MESSAGE_SIZE can be specified in the config.hpp file. |
| AcknowledgePacket    | ack_pkt_id   | 16 | This field contains the pkt_id of the DataPacket that has been received. |
| AcknowledgePacket    | dest         | 6 | This field contains the MAC address of the receiver. |
| AcknowledgePacket    | ttl          | 1 | A field that holds the TTL value of the packet — the maximum number of hops before the packet is dropped. |

### Node Discovery and Node Registry